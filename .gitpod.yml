image:
  file: .gitpod.Dockerfile

tasks:
  - name: Run PetClinic app
    init: ./mvnw -B dependency:go-offline package -DskipTests
    command: java -jar target/*.jar
    openMode: split-left
  - name: Start Tailscale & preflights
    before: |
      gpg --keyserver keys.openpgp.org --recv-keys 5993621FD9D214E212E421C3AC3A6CB9E464DBDA
      gpgconf --kill gpg-agent
    command: |
      screen -d -m sudo tailscaled --state=mem:
      sudo -E tailscale up --accept-dns --accept-routes --hostname "DEMO-${GITPOD_WORKSPACE_ID}" --authkey=$TS_AUTHKEY
    openMode: split-right
  - name: shell
    command: /usr/bin/bash
    openMode: tab-after

# exposed ports
ports:
- port: 8080
  onOpen: open-preview

vscode:
  extensions:
    - pivotal.vscode-spring-boot
    - vscjava.vscode-java-pack
    - redhat.java
    - vscjava.vscode-maven

github:
  prebuilds:
    master: true
    branches: true
    pullRequests: true
    pullRequestsFromForks: false
    addCheck: true
    addComment: true
    addBadge: true